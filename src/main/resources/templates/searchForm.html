<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/main_frame.css">
    <link rel="stylesheet" href="/css/left_menubar.css">
    <link rel="stylesheet" href="/css/right_trending.css">
    <link rel="stylesheet" href="/css/center_body_search.css">
    <title>Search</title>

    <script src="https://code.jquery.com/jquery-latest.min.js"></script>
</head>
<body>
    <div class="frame">

        <div class="inner_frame">

            <!-- left menu bar -->
            <div class="left_menubar">
                <div class="logo_main">
                    <img src="/icons/logo(main).svg" alt="movlog"/>
                </div>

                <div class="menu">
                    <div class="menu_element">
                        <button type="button" class="menu_button" id="home_btn">
                            <div class="menu_icon">
                                <img src="/icons/House.svg" alt="home"/>
                            </div>
                            <div class="menu_button_text">홈</div>
                        </button>
                    </div>
                    <div class="menu_element">
                        <button class="menu_button" id="notification_btn">
                            <div class="menu_icon">
                                <img src="/icons/Heart.svg" alt="notifications"/>
                            </div>
                            <div class="menu_button_text">알림</div>
                        </button>
                    </div>
                    <div class="menu_element">
                        <button class="menu_button" id="search_btn" value="search">
                            <div class="menu_icon">
                                <img src="/icons/MagnifyingGlass.svg" alt="Search"/>
                            </div>
                            <div class="menu_button_text">검색</div>
                        </button>
                    </div>
                    <div class="menu_element">
                        <button class="menu_button" id="watchedlsit_btn">
                            <div class="menu_icon">
                                <img src="/icons/EyeOpened.svg" alt="WatchList"/>
                            </div>
                            <div class="menu_button_text">내가 본 영화</div>
                        </button>
                    </div>
                    <div class="menu_element">
                        <button class="menu_button" id="watchlist_btn">
                            <div class="menu_icon">
                                <img src="/icons/EyeClosed.svg" alt="towatchlist"/>
                            </div>
                            <div class="menu_button_text">보고싶은 영화</div>
                        </button>
                    </div>
                    <div class="menu_element">
                        <button class="menu_button" id="profile_btn">
                            <div class="menu_icon">
                                <img src="/icons/UserCircle.svg" alt="profile"/>
                            </div>
                            <div class="menu_button_text">프로필</div>
                        </button>
                    </div>
                </div>

                <div class="left_footer">
                    <button class="profile">
                        <div class="account">
                            <div class="profile_img">
                                <img src="/img/example_profile_img.svg" alt="img"/>
                            </div>
                            <div class="user_info">
                                <div class="user_info_name" th:text="${loginMember.nickname}">
                                    김익명
                                </div>
                                <div class="user_info_account" th:text="${loginMember.loginId}">
                                    @anonymouskim123
                                </div>
                            </div>
                        </div>
                        <div class="more">
                            <img src="/icons/DotsThree.svg" alt="more"/>
                        </div>
                    </button>
                </div>
            </div>
        
            <!-- center body -->
            <div class="center_body">
                <div id="search_header">
                    <div class="right_search">
                        <img src="/icons/MagnifyingGlass.svg" width="24" alt="search"/>
                        <input type="text" class="search_input" placeholder="검색">
                    </div>
                    <div class="title">검색결과</div>
                </div>
                <!-- 검색결과 띄우는 창 -->
                <div id="search_body">
                    <th:block th:if="${movies != null}">
                        <div id="items">
                          <div th:each="movie : ${movies}">
                            <button type="button" class="item" th:value="${movie.id}">
                                <div class="item_contents">
                                    <div class="item_main">
                                        <div th:text="${movie.titleKo}"></div>
                                        <div class="item_Year">
                                            (
                                            <div th:text="${movie.prdtYear}"></div>
                                            )
                                        </div>
                                        
                                    </div>
                                    <div class ="item_nation" th:each="nation : ${movie.nations}">
                                        <div th:text="${nation.id}"></div>
                                    </div>

                                </div>
                              </button>
                          </div>
                        </div>
    
                    </th:block>

                </div>
            </div>
        
            <!-- right trending -->
            <div class="right_trending">
                <div class="right_trending_content">
                    <div class="right_search">
                        <img src="/icons/MagnifyingGlass.svg" width="24" alt="search"/>
                        <input type="text" class="search_input" placeholder="검색">
                    </div>
                </div>
            </div>
    
        </div>

        <!-- test -->
    </div>

    <script src="menu_control.js"></script>
    <script>
        const searchEvent = document.querySelectorAll(".search_input");
        for (let s of searchEvent) {
            s.addEventListener('keyup', e => {
                if (e.keyCode == 13) {
                    // querySelectorAll시 다시 객체 불러와야됨
                    const current = e.currentTarget;
                    let urlParam = new URLSearchParams(location.search);
                    urlParam.set("query", current.value);
                    let new_urlParam = urlParam.toString();
                    window.open(location.pathname + '?' + new_urlParam, '_self');

                }

            });
        }

        const movieSelect = document.querySelectorAll(".item");
        for (let s of movieSelect) {
            s.addEventListener("click", e => {
              const current = e.currentTarget;
              let urlParam = current.value;
              console.log(urlParam);
              window.open('/movie' + '/' + urlParam, '_self');
            });
        }
        

    </script>
</body>
</html>